本章では関連研究について, 本研究の構成要素である 「Random Walk エンジン」「分散グラフ処理システム」「地理的分散環境におけるグラフ処理システム」の 3 つに分けて紹介する. その後, 本研究の位置づけを述べる. 

\section{Random Walk エンジン}\label{sec:Random Walk エンジン}

Random Walk (RW) はグラフ解析において頻繁に用いられるため, その RW 演算を効率的に実行するシステムの開発は有意義なものであり, 複数の既存技術が存在する. 

ThunderRW\cite{10.14778/3476249.3476257}, FlashMob\cite{10.1145/3477132.3483575} は共有メモリシステムにおける RW 演算の最適化を目的とした手法である. RW 演算ではランダムな隣接頂点への遷移を繰り返すため, 不規則なメモリアクセスが課題となる. そこで ThunderRW では異なる RW クエリの実行を切り替えることによりメモリアクセスの待ち時間を隠蔽した. また FlashMob では, Random Walker (RWer) は高次数頂点に高頻度で訪れることに注目し, 高次数頂点の隣接辺の事前サンプリングを行うことで, RWer の遷移を DRAM への Sequential Read に置き換え, メモリアクセスのオーバヘッドを削減した. 

DrunkardMob\cite{10.1145/2507157.2507173}, GraphWalker\cite{254449}, NosWalker\cite{10.1145/3582016.3582025} はシングルマシンで動作する Out-of-Core RW エンジンである. Out-of-Core RW エンジンでは, 全てのグラフデータをメモリに載せて演算を行うのではなく, 必要なグラフデータを逐一メモリにロードしながら RW 演算を実行する. DRAM に対して低価格である SSD を利用してグラフデータを保持するため, 大規模グラフ上における RW 演算をより低コストで実行することが可能になる. NosWalker では, エッジサンプリングはエッジデータのみ, walker のアップデート処理は頂点データのみが必要となる RW の特性に注目し, それぞれの処理を分離する walker 指向の非連結アーキテクチャを採用している. 
% 最先端手法である NosWalker は, 汎用的な Out-of-Core グラフ処理フレームワークをベースとしている DrunkardMob, GraphWalker に対し, RW の特性を活かしたアーキテクチャを採用している.

KnightKing\cite{10.1145/3341301.3359634} はグラフデータを分散クラスタ上で保持する分散グラフ RW エンジンである. KnightKing には汎用性の高い API が設定されており, PPR, DeepWalk, MetaPath, Node2vec といった複数種類の RW を実行することができる. さらに KnightKing の貢献として, rejection ベースのエッジサンプリング手法による, 高次 RW アルゴリズムのコスト削減がある. RW 演算のボトルネックはエッジのサンプリング処理にあると言われており, walker の現在の状態, 前回訪れた頂点, 現在滞在している頂点のエッジの性質に依存するような動的サンプリングを必要とする高次 RW は顕著にその傾向を示している. KnightKing の rejection ベースのエッジサンプリングは O(d) (d: 頂点における次数)かかっていたエッジの動的サンプリングを O(1) (前計算 O(n), n: 頂点数) に削減した.

\section{分散グラフ処理システム}\label{sec:分散グラフ処理システム}

近年のグラフデータの増加に伴い, 分散クラスタ上で動作する分散グラフ処理システムの重要性が高まっている. 分散グラフ処理における主流なプログラミングモデルとして, Bulk Synchronous Parallel (BSP) モデルがある. BSP モデルは, スーパーステップと呼ばれる単位で処理を繰り返し行うモデルであり, このスーパーステップは主に
\begin{itemize}
    \item サーバごとでの計算
    \item サーバ間同期
\end{itemize}
で構成される. 同期型である BSP モデルを非同期型にすることで処理を高速化する手法も存在する\cite{BAP}\cite{AAP}\cite{Gluon-Async}が, 実装の複雑化や, データセンター内等の広帯域環境では同期のオーバヘッドがさほど大きくならないことから, BSP モデルが採用されることが多い. 

BSP モデルの分散グラフシステムのうち, 頂点の状態に注目した手法\cite{Pregel}\cite{10.1145/2741948.2741970}\cite{10.5555/2387880.2387883}\cite{10.5555/3026877.3026901}\cite{Gluon}は vertex-centric なモデルと呼ばれる. vertex-centric モデルにおける各スーパーステップでは, 各頂点が, 直前のスーパーステップで送られたメッセージに基づいて自身の状態を更新し, 結果を他の頂点に送信する. ユーザは頂点における更新に関する処理を記述するのみであり, PageRank, Single Source Shortest Path, connected components 等の多くのグラフアルゴリズムはこの vertex-centric の形で書き下すことが可能である. 

対して\ref{sec:Random Walk エンジン} 節で紹介した KnightKing は, 処理単位が RWer であることから walker-centric モデルと呼ばれている. 図\ref{walker centric モデル (同期型) の概要} は walker-centric モデルの概要を示しており, 各スーパーステップでは, 
\begin{itemize}
    \item 各 RWer がユーザー定義の RW を実行 (1 ステップ進める) し, 状態を更新
    \item 状態を更新した RWer の内, 他のサーバが管理する頂点へ遷移した RWer を送信し, 全サーバで同期
\end{itemize}
を行う. vertex-centric モデルを採用しないのは, RW における RWer の概念は, 既存の vertex-centric モデルのシステムではメッセージとして扱われるため, RWer の状態更新の追跡や最適化のための機能が失われる可能性が高いためである. 

\begin{figure}[t]
    \centering
    \includegraphics[scale=0.7]{figure/walkercentric.pdf}
    \caption{walker centric モデル (同期型) の概要}
    \label{walker centric モデル (同期型) の概要}
\end{figure}

\section{地理的分散環境におけるグラフ処理システム}

% 地理的に分散した環境でグラフデータが生成, 管理される状態を想定したグラフ解析システム\cite{10.5555/3277180.3277185}\cite{8486361}\cite{10.1145/3397271.3401157}も存在する. 
グラフクエリは, PageRank Web 検索\cite{334}, SNS 検索\cite{10.5555/2535461.2535468}, ナレッジグラフ検索\cite{10.1145/3331184.3331252}など, 多くの一般的なインターネットサービスの基盤となっているが, このようなグラフクエリで処理されるグラフは巨大であり, 変化の速度も速い\cite{10.1145/2723372.2735365}ため, 広域ネットワーク (WAN) でのデータ転送のコストが高い. さらに GDPR 等のプライバシー規制も相まって, グラフデータ全体を一箇所に集めることは極めて困難である. そのため, 地理的に分散した環境下における効率的なグラフ処理システムの開発が重要となる. 

\ref{sec:分散グラフ処理システム} 節で紹介した分散グラフ処理システムは, 単一のデータセンター内のサーバクラスタのような高帯域・低遅延な環境下で実行することを想定しているため, 低帯域・高遅延の WAN での実行では大きく性能が劣化する. これは BSP モデルのスーパーステップにおける隣接ノード間の通信がアルゴリズムの収束まで何度も繰り返されるからである. 

そこで, 既存の地理的分散環境下を想定した分散グラフ処理システム\cite{10.5555/3277180.3277185}\cite{8486361}\cite{10.1145/3397271.3401157} は \ref{sec:分散グラフ処理システム} における一般的な vertex-centric モデルの通信削減に注力している. HSP モデル\cite{8486361} では, サーバ間の同期をデータセンター内とデータセンター間で 2 階層に分けることにより, データセンター間での通信量を削減する. また, GeoGraph\cite{10.1145/3397271.3401157} では, WAN レイテンシに基づきデータセンターをグループ化し, そのグループ間の通信量を削減する. どちらも低帯域・高遅延な部分の通信削減を目的としていることがわかる. 

\section{本研究の位置づけ}

まず, Random Walk エンジンとしての本研究の位置づけについて述べる. 図 \ref{Random Walk エンジンの分類} にマシン数と目的による Random Walk エンジンの分類を示す. 提案手法は, マルチマシンによる地理的分散環境下での実行を目的とした手法に分類される. ThunderRW, FlashMob 等のシングルマシンにおけるメモリアクセスの改善を目的とした手法は, グラフの変化に対応することができないため, 本研究が想定する地理的分散環境下への適用が困難である. DrunkardMob, GraphWalker, NosWalker は大規模グラフでの RW 実行をシングルマシンで行うことによりコストを抑えようとしているため, 分散環境を許容している本研究とは目的と手段がそれぞれ異なる. KnightKing は単一データセンターでの RW 実行を目的とした, 分散グラフ RW エンジンであり, TCP 通信による同期処理を採用している. しかし本研究が想定する地理的分散環境下では RTT・パケットロス率が高くなり, TCP 通信のスループットが大幅に低下するため, 同期のオーバヘッドが大きくなる. また, RW の特徴である終盤の少数の RWer のためにわざわざ同期処理を行うのは無駄が多い. 

次に分散グラフ処理システムとしての本研究の位置づけについて述べる. 図 \ref{分散グラフ処理システムの分類} に分散グラフ処理システムの分類を示す. 提案手法は, 地理的分散環境下における walker-centric モデルの手法に分類される. HSP モデル, GeoGraph は vertex-centric モデルにおける通信削減を目的としている. vertex-centric モデルの計算では, 頂点間の同期の順番を入れ替えることで, 値の収束を早めたりサーバ間の通信量を減らすことができるが, walker-centric モデルでは RWer の遷移先を変更できないためサーバ間の通信量を減らすことができない. つまり HSP モデル, GeoGraph を walker-centric モデルに 適用させることはできない. 

\begin{figure}[t]
    \centering
    \includegraphics[scale=0.5]{figure/RWEngine.pdf}
    \caption{Random Walk エンジンの分類}
    \label{Random Walk エンジンの分類}
\end{figure}

\begin{figure}[t]
    \centering
    \includegraphics[scale=0.5]{figure/DistributedSystem.pdf}
    \caption{分散グラフ処理システムの分類}
    \label{分散グラフ処理システムの分類}
\end{figure}